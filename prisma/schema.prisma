generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model invoice {
  id Int @id @default(autoincrement())
  bubble_id String @unique
  last_synced_at DateTime? @default(now())
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())
  visit Int?
  eligible_amount_description String?
  linked_seda_registration String?
  normal_commission Decimal?
  linked_agent String?
  performance_tier_month Int?
  full_payment_date DateTime?
  modified_date DateTime?
  need_approval Boolean?
  linked_package String?
  locked_package Boolean?
  linked_customer String?
  panel_qty Int?
  dealercode String?
  linked_agreement String?
  performance_tier_year Int?
  invoice_id Int?
  type String?
  last_payment_date DateTime?
  approval_status String?
  first_payment_date DateTime?
  commission_paid Boolean?
  paid Boolean?
  version Int?
  amount_eligible_for_comm Decimal?
  second_payment Int?
  created_by String?
  linked_payment String[]
  amount Decimal?
  invoice_date DateTime?
  first_payment Int?
  logs String?
  linked_stock_transaction String[]
  stamp_cash_price Decimal?
  percent_of_total_amount Decimal?
  created_date DateTime?
  stock_status_inv String?
  linked_invoice_item String[]
  perf_tier_commission Int?
  linked_agent_monthly_perf String?
  how_you_win String?
  stock_status String?
  customer_average_tnb Int?
  estimated_saving Decimal?
  linked_roof_image String[]
  description String?
  state String?
  linked_notification String[]
  linked_follow_up String[]
  case_status String?
  referrer_name String?
  customer_signature String?
  signature_date DateTime?
  estimated_new_bill_amount Decimal?
  effective_epp Decimal?
  lead_source String?
  strategic_va Decimal?
  hide_payment_terms Boolean?
  premium_electrical_job Boolean?
  panel_rating Int?
  custom_proposal String?
  package_type String?
  request_urgent_submission String?
  linked_voucher String[]
  approved_toberemove Boolean?
  user_manual_pdf String?
  linked_payment_plan String?
  linked_saving_report String?
  linked_lead_from_customer String[]
  achieved_monthly_anp Decimal?

  @@index([bubble_id])
  @@index([paid])
  @@index([invoice_id])
}

model payment {
  id Int @id @default(autoincrement())
  bubble_id String @unique
  last_synced_at DateTime? @default(now())
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())
  payment_method String?
  modified_date DateTime?
  amount Decimal?
  created_by String?
  linked_agent String?
  created_date DateTime?
  remark String?
  payment_date DateTime?
  linked_invoice String?
  linked_customer String?
  payment_index Int?
  attachment String[]
  verified_by String?
  edit_history String?
  issuer_bank String?
  epp_month Int?
  payment_method_v2 String?
  terminal String?
  bank_charges Int?
  epp_type String?

  @@index([bubble_id])
  @@index([linked_invoice])
}

model agent {
  id Int @id @default(autoincrement())
  bubble_id String @unique
  last_synced_at DateTime? @default(now())
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())
  modified_date DateTime?
  linked_user_login String?
  name String?
  current_annual_sales Int?
  contact String?
  created_date DateTime?
  last_update_annual_sales DateTime?
  slug String?
  agent_type String?
  commission Int?
  annual_collection Int?
  intro_youtube String?
  created_by String?
  tree_seed String?
  email String?
  banker String?
  bankin_account String?
  introducer String?
  ic_front String?
  ic_back String?
  address String?

  @@index([bubble_id])
}

model customer_profile {
  id Int @id @default(autoincrement())
  bubble_id String @unique
  last_synced_at DateTime? @default(now())
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())
  linked_agent String?
  address String?
  name String?
  created_by String?
  contact String?
  status String?
  created_date DateTime?
  modified_date DateTime?
  whatsapp String?
  state String?
  link_seda_reg String?
  chinese_content Boolean?
  group_status Boolean?

  @@index([bubble_id])
}

model customer {
  id Int @id @default(autoincrement())
  bubble_id String
  last_synced_at DateTime? @default(now())
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())
}

model user {
  id Int @id @default(autoincrement())
  bubble_id String @unique
  last_synced_at DateTime? @default(now())
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())
  access_level String[]
  linked_agent_profile String?
  authentication String?
  profile_picture String?
  dealership String?
  created_date DateTime?
  check_in_report_today String?
  user_signed_up Boolean?
  modified_date DateTime?
}

model agent_daily_report {
  id Int @id @default(autoincrement())
  bubble_id String @unique
  last_synced_at DateTime? @default(now())
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())
  activity_type String?
  modified_date DateTime?
  linked_user String?
  linked_customer String?
  report_point Int?
  created_date DateTime?
  tag String[]
  report_date DateTime?
  created_by String?
  remark String?
}

model agent_monthly_commission {
  id Int @id @default(autoincrement())
  bubble_id String? @unique
  linked_invoice String[]
  created_by String?
  linked_agent String?
  record_month DateTime?
  total_bonus_comm Int?
  total_normal_comm String?
  created_date DateTime?
  modified_date DateTime?
  synced_at DateTime? @default(now())
}

model commission_adjustment {
  id                  String    @id @default(cuid())
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt
  agent_id            String
  agent_name          String
  amount              Decimal
  description         String
  created_by          String
  report_id           String?
  adjustment_month    String?
  generated_commission_report generated_commission_report? @relation(fields: [report_id], references: [report_id])
}

model generated_commission_report {
  report_id String @id
  agent_id String
  agent_name String
  month_period String
  total_basic_commission Decimal
  total_bonus_commission Decimal
  total_adjustments Decimal
  final_total_commission Decimal
  commission_paid Boolean
  invoice_bubble_ids Json
  created_at DateTime
  created_by String?
  paid_at DateTime?
  paid_by String?
  linked_adjustment commission_adjustment[]
}

model package_model {
  id Int @id @default(autoincrement())
  bubble_id String @unique
  last_synced_at DateTime? @default(now())
  created_at DateTime? @default(now())
  updated_at DateTime? @default(now())
  price Decimal?
  package_name String?
  modified_date DateTime?
  created_date DateTime?
  panel_qty Int?
  type String?
  created_by String?
  max_discount Int?
  linked_package_item String[]
  invoice_desc String?
  special Boolean?
  panel String?
  active Boolean?
  need_approval Boolean?
  password String?
}

model product {
  id Int @id @default(autoincrement())
  bubble_id String? @unique
  created_by String?
  linked_brand String?
  warranty_name String?
  linked_category String?
  product_warranty__desc_ String?
  image String?
  cost_price Int?
  active_ Boolean?
  name String?
  inventory Boolean?
  modified_date DateTime?
  label String?
  selling_price Int?
  warranty_link String?
  description String?
  created_date DateTime?
  solar_output_rating Int?
  pdf_product String?
  synced_at DateTime? @default(now())
}

model support_ticket {
  id Int @id @default(autoincrement())
  bubble_id String? @unique
  created_date DateTime?
  modified_date DateTime?
  created_by String?
  link_customer String?
  problem_description String?
  technician_remark String?
  status String?
  title String?
  images String[]
  synced_at DateTime? @default(now())
}

model system_logs {
  id Int @id @default(autoincrement())
  timestamp DateTime
  run_id String
  level String
  context String
  message String
  metadata Json?
  created_at DateTime? @default(now())
}

model sync_status {
  id String @id
  running Boolean
  progress Int
  currentTable String?
  lastSync DateTime?
  error String?
  createdAt DateTime
  updatedAt DateTime
}

model synced_records {
  id String @id
  bubble_id String
  data_type String
  raw_data Json
  processed_data Json?
  synced_at DateTime
  updated_at DateTime
}

model pending_schema_patches {
  id Int @id @default(autoincrement())
  table_name String
  field_name String
  original_field_name String?
  suggested_type String
  error_message String?
  status String
  created_at DateTime @default(now())
  approved_at DateTime?
  approved_by String?
  executed_at DateTime?
  execution_result String?
  sync_run_id String?
}

model sync_cursors {
  id Int @id @default(autoincrement())
  table_name String
  last_cursor Int
  last_sync_at DateTime @default(now())
  sync_run_id String?
  created_at DateTime @default(now())
  updated_at DateTime @default(now())
}


model relationship_discovery_status {
  id Int @id @default(autoincrement())
  source_table String
  source_field String
  field_type String
  link_status String?
  target_table String?
  last_checked DateTime @default(now())
  created_at DateTime @default(now())
}

model discovery_logs {
  id Int @id @default(autoincrement())
  run_id String
  table_name String
  field_name String
  field_type String
  link_status String?
  target_table String?
  sample_value String?
  reason String?
  bubble_id_count Int?
  discovered_at DateTime @default(now())
}

